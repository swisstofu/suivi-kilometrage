<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Suivi de kilométrage Volvo EX 30</title>
        <link
            rel="icon"
            type="image/svg+xml"
            href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%234f46e5' width='100' height='100'/%3E%3Cpath fill='%23ffffff' d='M20 65 L20 55 L25 45 L35 40 L65 40 L75 45 L80 55 L80 65 Z'/%3E%3Crect fill='%2393c5fd' x='30' y='45' width='15' height='10' rx='2'/%3E%3Crect fill='%2393c5fd' x='55' y='45' width='15' height='10' rx='2'/%3E%3Ccircle fill='%23374151' cx='30' cy='65' r='6'/%3E%3Ccircle fill='%23d1d5db' cx='30' cy='65' r='3'/%3E%3Ccircle fill='%23374151' cx='70' cy='65' r='6'/%3E%3Ccircle fill='%23d1d5db' cx='70' cy='65' r='3'/%3E%3Crect fill='%23fbbf24' x='22' y='50' width='3' height='2' rx='1'/%3E%3Crect fill='%23fbbf24' x='75' y='50' width='3' height='2' rx='1'/%3E%3Cpath fill='%23e5e7eb' d='M35 55 L40 55 L42 58 L38 58 Z'/%3E%3Cpath fill='%23e5e7eb' d='M65 55 L60 55 L58 58 L62 58 Z'/%3E%3C/svg%3E"
        />

        <!-- Icônes pour iOS et autres appareils -->
        <link
            rel="apple-touch-icon"
            href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect fill='%234f46e5' width='180' height='180' rx='40'/%3E%3Cpath fill='%23ffffff' d='M36 117 L36 99 L45 81 L63 72 L117 72 L135 81 L144 99 L144 117 Z'/%3E%3Crect fill='%2393c5fd' x='54' y='81' width='27' height='18' rx='4'/%3E%3Crect fill='%2393c5fd' x='99' y='81' width='27' height='18' rx='4'/%3E%3Ccircle fill='%23374151' cx='54' cy='117' r='11'/%3E%3Ccircle fill='%23d1d5db' cx='54' cy='117' r='5'/%3E%3Ccircle fill='%23374151' cx='126' cy='117' r='11'/%3E%3Ccircle fill='%23d1d5db' cx='126' cy='117' r='5'/%3E%3Crect fill='%23fbbf24' x='39' y='90' width='5' height='4' rx='2'/%3E%3Crect fill='%23fbbf24' x='135' y='90' width='5' height='4' rx='2'/%3E%3Cpath fill='%23e5e7eb' d='M63 99 L72 99 L75.6 104.4 L68.4 104.4 Z'/%3E%3Cpath fill='%23e5e7eb' d='M117 99 L108 99 L104.4 104.4 L111.6 104.4 Z'/%3E%3C/svg%3E"
        />

        <!-- Métadonnées pour PWA sur iOS -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta
            name="apple-mobile-web-app-title"
            content="Suivi de kilométrage Volvo EX 30"
        />

        <script
            crossorigin
            src="https://unpkg.com/react@18/umd/react.production.min.js"
        ></script>
        <script
            crossorigin
            src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
        ></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body>
        <div id="root"></div>

        <script type="text/babel">
            const { useState, useEffect } = React;

            // Icônes SVG simplifiées
            const Car = () => (
                <svg
                    className="w-8 h-8 text-indigo-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"
                    />
                    <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h4a1 1 0 001-1m-6 0V9h4v7"
                    />
                </svg>
            );

            const Calendar = () => (
                <svg
                    className="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                    />
                </svg>
            );

            const Gauge = () => (
                <svg
                    className="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M13 10V3L4 14h7v7l9-11h-7z"
                    />
                </svg>
            );

            const TrendingUp = () => (
                <svg
                    className="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                    />
                </svg>
            );

            const TrendingDown = () => (
                <svg
                    className="w-6 h-6 text-green-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"
                    />
                </svg>
            );

            const TrendingUpLarge = () => (
                <svg
                    className="w-6 h-6 text-orange-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                    />
                </svg>
            );

            function KilometrageTracker() {
                // Fonction pour charger les valeurs depuis le localStorage de manière sécurisée (compatible iOS)
                const chargerValeur = (cle, valeurParDefaut) => {
                    try {
                        const valeurStockee = localStorage.getItem(cle);
                        if (valeurStockee !== null) {
                            return typeof valeurParDefaut === "number"
                                ? Number(valeurStockee)
                                : valeurStockee;
                        }
                    } catch (error) {
                        console.warn(
                            "Erreur lors de la lecture du localStorage:",
                            error,
                        );
                    }
                    return valeurParDefaut;
                };

                const [dateAchat, setDateAchat] = useState(() =>
                    chargerValeur("dateAchat", "2025-05-22"),
                );
                const [quotaAnnuel, setQuotaAnnuel] = useState(() =>
                    chargerValeur("quotaAnnuel", 20000),
                );
                const [kmActuel, setKmActuel] = useState(() =>
                    chargerValeur("kmActuel", 6160),
                );
                const [resultat, setResultat] = useState(null);

                // Sauvegarder dans le localStorage à chaque changement
                useEffect(() => {
                    try {
                        localStorage.setItem("dateAchat", dateAchat);
                    } catch (error) {
                        console.warn(
                            "Erreur lors de la sauvegarde de dateAchat:",
                            error,
                        );
                    }
                }, [dateAchat]);

                useEffect(() => {
                    try {
                        localStorage.setItem(
                            "quotaAnnuel",
                            String(quotaAnnuel),
                        );
                    } catch (error) {
                        console.warn(
                            "Erreur lors de la sauvegarde de quotaAnnuel:",
                            error,
                        );
                    }
                }, [quotaAnnuel]);

                useEffect(() => {
                    try {
                        localStorage.setItem("kmActuel", String(kmActuel));
                    } catch (error) {
                        console.warn(
                            "Erreur lors de la sauvegarde de kmActuel:",
                            error,
                        );
                    }
                }, [kmActuel]);

                useEffect(() => {
                    calculerResultat();
                }, [dateAchat, quotaAnnuel, kmActuel]);

                const calculerResultat = () => {
                    if (!dateAchat || !quotaAnnuel || kmActuel === "") return;

                    const dateDebut = new Date(dateAchat);
                    const dateActuelle = new Date();
                    const joursEcoules = Math.floor(
                        (dateActuelle - dateDebut) / (1000 * 60 * 60 * 24),
                    );
                    const moisEcoules = joursEcoules / 30.44;

                    const kmParJour = quotaAnnuel / 365;
                    const kmAttendu = Math.round(kmParJour * joursEcoules);
                    const difference = kmActuel - kmAttendu;
                    const pourcentage = Math.round(
                        (kmActuel / kmAttendu) * 100,
                    );

                    const kmParMois = quotaAnnuel / 12;
                    const rythmeActuel =
                        moisEcoules > 0
                            ? Math.round((kmActuel / moisEcoules) * 12)
                            : 0;

                    setResultat({
                        joursEcoules,
                        moisEcoules: moisEcoules.toFixed(1),
                        kmAttendu,
                        difference,
                        pourcentage,
                        enDessous: difference < 0,
                        rythmeActuel,
                        kmParJour: kmParJour.toFixed(1),
                        kmParMois: Math.round(kmParMois),
                    });
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-8">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-6 md:p-8">
                                <div className="flex items-center gap-3 mb-6">
                                    <Car />
                                    <h1 className="text-3xl font-bold text-gray-800">
                                        Suivi de kilométrage Volvo EX 30
                                    </h1>
                                </div>

                                <div className="space-y-6">
                                    <div>
                                        <label className="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                            <Calendar />
                                            Date d'achat du véhicule
                                        </label>
                                        <input
                                            type="date"
                                            value={dateAchat}
                                            onChange={(e) =>
                                                setDateAchat(e.target.value)
                                            }
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none transition text-base"
                                            style={{
                                                WebkitAppearance: "none",
                                                MozAppearance: "none",
                                                appearance: "none",
                                                minHeight: "48px",
                                            }}
                                        />
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                            <TrendingUp />
                                            Quota annuel (km)
                                        </label>
                                        <input
                                            type="number"
                                            value={quotaAnnuel}
                                            onChange={(e) =>
                                                setQuotaAnnuel(
                                                    Number(e.target.value),
                                                )
                                            }
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none transition"
                                        />
                                    </div>

                                    <div>
                                        <label className="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-2">
                                            <Gauge />
                                            Kilométrage actuel
                                        </label>
                                        <input
                                            type="number"
                                            value={kmActuel}
                                            onChange={(e) =>
                                                setKmActuel(
                                                    Number(e.target.value),
                                                )
                                            }
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none transition"
                                        />
                                    </div>
                                </div>

                                {resultat && (
                                    <div className="mt-8 space-y-4">
                                        <div
                                            className={`p-6 rounded-xl ${resultat.enDessous ? "bg-green-50 border-2 border-green-200" : "bg-orange-50 border-2 border-orange-200"}`}
                                        >
                                            <div className="flex items-center gap-3 mb-4">
                                                {resultat.enDessous ? (
                                                    <TrendingDown />
                                                ) : (
                                                    <TrendingUpLarge />
                                                )}
                                                <h2
                                                    className={`text-xl font-bold ${resultat.enDessous ? "text-green-800" : "text-orange-800"}`}
                                                >
                                                    {resultat.enDessous
                                                        ? "✓ En dessous de la moyenne"
                                                        : "⚠ Au-dessus de la moyenne"}
                                                </h2>
                                            </div>

                                            <div className="grid grid-cols-2 gap-4 mb-4">
                                                <div className="bg-white p-4 rounded-lg">
                                                    <div className="text-sm text-gray-600 mb-1">
                                                        Kilométrage attendu
                                                    </div>
                                                    <div className="text-2xl font-bold text-gray-800">
                                                        {resultat.kmAttendu.toLocaleString(
                                                            "fr-FR",
                                                        )}{" "}
                                                        km
                                                    </div>
                                                </div>
                                                <div className="bg-white p-4 rounded-lg">
                                                    <div className="text-sm text-gray-600 mb-1">
                                                        Votre kilométrage
                                                    </div>
                                                    <div className="text-2xl font-bold text-indigo-600">
                                                        {kmActuel.toLocaleString(
                                                            "fr-FR",
                                                        )}{" "}
                                                        km
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="bg-white p-4 rounded-lg mb-4">
                                                <div className="text-sm text-gray-600 mb-2">
                                                    Différence
                                                </div>
                                                <div
                                                    className={`text-3xl font-bold ${resultat.enDessous ? "text-green-600" : "text-orange-600"}`}
                                                >
                                                    {resultat.enDessous
                                                        ? ""
                                                        : "+"}
                                                    {resultat.difference.toLocaleString(
                                                        "fr-FR",
                                                    )}{" "}
                                                    km
                                                </div>
                                                <div className="text-sm text-gray-600 mt-1">
                                                    ({resultat.pourcentage}% de
                                                    la moyenne)
                                                </div>
                                            </div>

                                            <div className="text-sm text-gray-700 space-y-2">
                                                <p>
                                                    <strong>
                                                        Période écoulée :
                                                    </strong>{" "}
                                                    {resultat.joursEcoules}{" "}
                                                    jours (
                                                    {resultat.moisEcoules} mois)
                                                </p>
                                                <p>
                                                    <strong>
                                                        Moyenne autorisée :
                                                    </strong>{" "}
                                                    {resultat.kmParJour} km/jour
                                                    ou {resultat.kmParMois}{" "}
                                                    km/mois
                                                </p>
                                                <p>
                                                    <strong>
                                                        Votre rythme actuel :
                                                    </strong>{" "}
                                                    {resultat.rythmeActuel.toLocaleString(
                                                        "fr-FR",
                                                    )}{" "}
                                                    km/an
                                                </p>
                                            </div>
                                        </div>

                                        {resultat.enDessous && (
                                            <div className="bg-blue-50 border-2 border-blue-200 p-4 rounded-lg">
                                                <p className="text-blue-800 text-sm">
                                                    <strong>
                                                        Bonne nouvelle !
                                                    </strong>{" "}
                                                    À ce rythme, vous terminerez
                                                    l'année à environ{" "}
                                                    <strong>
                                                        {resultat.rythmeActuel.toLocaleString(
                                                            "fr-FR",
                                                        )}{" "}
                                                        km
                                                    </strong>
                                                    , bien en dessous de votre
                                                    limite de{" "}
                                                    {quotaAnnuel.toLocaleString(
                                                        "fr-FR",
                                                    )}{" "}
                                                    km.
                                                </p>
                                            </div>
                                        )}

                                        {!resultat.enDessous && (
                                            <div className="bg-orange-50 border-2 border-orange-200 p-4 rounded-lg">
                                                <p className="text-orange-800 text-sm">
                                                    <strong>Attention !</strong>{" "}
                                                    À ce rythme, vous risquez de
                                                    dépasser votre quota.
                                                    Projeté sur l'année :{" "}
                                                    <strong>
                                                        {resultat.rythmeActuel.toLocaleString(
                                                            "fr-FR",
                                                        )}{" "}
                                                        km
                                                    </strong>
                                                    .
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            ReactDOM.render(
                <KilometrageTracker />,
                document.getElementById("root"),
            );
        </script>
    </body>
</html>
